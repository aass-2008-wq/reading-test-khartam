 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ุงุฎุชุจุงุฑ ุงูููู ุงููุฑุงุฆู โ ููุชุฒู ุฎุฑุทู</title>
<style>
  :root{
    --green:#1e7f3d; --green-700:#156733; --green-50:#f1fbf5; --gold:#c9a544; --ink:#0b2e19;
    --card-bg:rgba(255,255,255,.94); --bd:#e6efe9; --muted:#38684e;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI","Noto Naskh Arabic UI","Tahoma",sans-serif;background:linear-gradient(180deg,var(--green-50),#e9f7ef);color:var(--ink)}
  .app{max-width:980px;margin:24px auto;padding:16px}
  .card{position:relative;background:var(--card-bg);border:1px solid var(--bd);border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.12);overflow:hidden}
  .card::before{content:"";position:absolute;inset:0;background:url("https://i.postimg.cc/Lhdfcttc/IMG-7700.jpg") center/420px 420px no-repeat;opacity:.08;pointer-events:none;mix-blend-mode:multiply}
  header.hero{padding:20px 20px 12px;background:linear-gradient(90deg,var(--green),var(--green-700));color:#fff;border-bottom:4px solid var(--gold)}
  header.hero h1{margin:0 0 8px;font-size:clamp(20px,3.2vw,28px)}
  header.hero .sub{opacity:.95;font-size:15px}
  .content{padding:18px;position:relative;z-index:1}
  .badge{display:inline-block;background:var(--gold);color:#2d2005;padding:4px 10px;border-radius:999px;font-weight:700;font-size:13px;margin-bottom:8px}
  .row{display:flex;gap:16px;flex-wrap:wrap}.col{flex:1 1 320px}
  .input{width:100%;border:1px solid #dfe9e3;border-radius:10px;padding:12px 14px;font-size:16px;background:#fff}
  .btn{appearance:none;border:none;border-radius:12px;padding:12px 18px;font-size:16px;cursor:pointer;background:var(--green);color:#fff;font-weight:800;box-shadow:0 6px 16px rgba(30,127,61,.25);transition:transform .06s}
  .btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(0) scale(.98)}
  .btn.secondary{background:#0b2e19} .btn.ghost{background:transparent;color:var(--green);border:2px solid var(--green);box-shadow:none}
  .muted{color:var(--muted)} .foot-note{font-size:13px;color:#35654c;margin-top:8px}
  .long-text{background:#ffffffd9;border:1px solid #eaf3ee;border-radius:12px;padding:14px 16px;line-height:1.9}
  .choice{border:1px solid #e0eee6;background:#fff;padding:12px;border-radius:12px;margin:10px 0;display:flex;gap:10px;align-items:flex-start}
  .choice:hover{background:#f6fbf8;border-color:#cfe6da}
  .choice.correct{border-color:#18a957;background:#eefbf3} .choice.wrong{border-color:#d35454;background:#fff1f1}
  .progress{height:10px;background:#e9f5ee;border-radius:999px;overflow:hidden;border:1px solid #dbeee3}
  .progress>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#1e7f3d,#2fb36a)}
  .score-big{font-size:clamp(34px,6vw,48px);margin:6px 0 0;color:var(--ink)}
  .top5{list-style:none;padding:0;margin:10px 0 0;border:1px solid var(--bd);border-radius:12px;overflow:hidden}
  .top5 li{padding:10px 12px;background:#fff;display:flex;justify-content:space-between;align-items:center}
  .top5 li:nth-child(odd){background:#f8fcf9} .pill{background:#e8f6ee;color:var(--ink);padding:2px 10px;border-radius:999px;font-weight:800}
  footer.credit{text-align:center;padding:10px 14px 18px;color:#2d2005}
  footer .sig{display:inline-block;background:linear-gradient(90deg,#f3e5c1,#e8d292);color:#2d2005;border:1px solid #e2c988;padding:6px 12px;border-radius:10px;font-weight:800}
  .screen{display:none}.screen.active{display:block}
  .timer{font-weight:800;color:#0b3b22}
  .cert{border:2px dashed #d9e8de;background:#ffffff; padding:16px;border-radius:12px;margin-top:16px}
  .cert h3{margin:4px 0 8px}
  @media(hover:none){.btn:hover{transform:none}}
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <header class="hero">
      <div class="badge">ุงุฎุชุจุงุฑ ููู ููุฑูุก</div>
      <h1>ุฑุญูุฉ ุฅูู <span style="color:#c9e8d6;">ููุชุฒู ุฎุฑุทู</span></h1>
      <div class="sub">ูุฏุฑุณุฉ ุงูุฅูุงู ุงูุดููุงูู โ ุงูุตู ุงูุณุงุฏุณ</div>
    </header>

    <div class="content">
      <!-- ุดุงุดุฉ ุงูุจุฏุงูุฉ -->
      <section id="screen-welcome" class="screen active">
        <h2 style="margin:6px 0 10px">ูุฑุญุจูุง ุจู ๐</h2>
        <p class="muted">ุงูุชุจ ุงุณูู ุซู ุงุจุฏุฃ ุงููุฑุงุกุฉ ูุงูุฅุฌุงุจุฉ. ุงูุฏุฑุฌุฉ ูู 100ุ ูููุฌุฏ <strong>ุชูุจ ูุงูู</strong> ูุฃุนูู ุงูุฏุฑุฌุงุช.</p>
        <label for="studentName" class="muted">ุงุณู ุงูุทุงูุจ</label>
        <input id="studentName" class="input" placeholder="ุงูุชุจ ุงุณูู ููุง" autocomplete="off" />
        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn" id="btnStart">ุงุจุฏุฃ ุงูุงุฎุชุจุงุฑ</button>
          <button class="btn ghost" id="btnViewTop">ุนุฑุถ ุงูุชูุจ ูุงูู</button>
        </div>
        <p class="foot-note">ุชูููุญ: ูููุถูู ุงุณุชุฎุฏุงู ุงูุงุณู ุงูุฃูู ููุท ุญูุงุธูุง ุนูู ุงูุฎุตูุตูุฉ.</p>
      </section>

      <!-- ูุต ุงููุฑุงุกุฉ -->
      <section id="screen-reading" class="screen">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
          <h3 style="margin:0">ุงูุฑุฃ ุงููุต ุงูุชุงูู ุจุนูุงูุฉ:</h3>
          <div class="timer">โณ ุงูููุช: <span id="timeLeft">โ</span></div>
        </div>
        <article class="long-text" id="readingText">
          <strong>ุนููุงู ุงููุต: "ุฑุญูุฉ ุฅูู ููุชุฒู ุฎูุฑูุทูู"</strong><br><br>
          ูู ุตุจุงุญู ุฌูููู ูู ุฃูุงู ูุตู ุงูุดุชุงุกุ ูุฑูุฑ ุทูุงุจู ุงูุตููู ุงูุณุงุฏุณ ูู ูุฏุฑุณุฉ ุงูุฅูุงู ุงูุดููุงูู ุงูููุงูู ุจุฑุญูุฉู ุชุนููููุฉู ุฅูู
          <em>ููุชุฒู ุฎูุฑูุทูู</em>ุ ููู ูู ุงูุฃูุงูู ุงูุทุจูุนูุฉ ุงูุฌูููุฉ ุงูุชู ููุตุฏูุง ุงูุฒููุงุฑ ููุงุณุชูุชุงุน ุจุงูููุงุก ุงูููู ูุงูุทุจูุนุฉ ุงููุงุฏุฆุฉ.
          ุงูุทูู ุงูุทูุงุจู ูุน ูุนููููู ุจุงูุญุงููุฉ ููู ูุดุนุฑูู ุจุงูุญูุงุณ ูุงููุฑุญุ ููุงููุง ูุชุทููุนูู ูุฑุคูุฉ ุงูุฃุดุฌุงุฑ ูุงูุฌุจุงู ุงูุตุบูุฑุฉ ุงูุชู ุณูุนูุง ุนููุง ูุซูุฑูุง.<br><br>
          ุญูู ูุตููุง ุฅูู ุงูููุชุฒูุ ุงุณุชูุจูุชูู ุงูุทุจูุนุฉู ุจุฌูุงูู ุฃุฎููุงุฐุ ููุฏ ุงูุชุดุฑุช ุงูุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก ูู ูููู ููุงูุ ูุจุฏุช ุงูุฃุฑุถู ููุณูููุฉู ุจุงูุฃุนุดุงุจุ
          ุจูููุง ูุงู ุงูููุงุก ุงูุนููู ูููุนุด ุงููููุณ. ุจุฏุฃ ุงูุทูุงุจู ุจุงูุชุฌููู ููู ูุณุฌูููู ููุงุญุธุงุชูู ูู ุฏูุงุชุฑููุ ููุง ุงูุชูุทูุง ุงูุนุฏูุฏ ูู ุงูุตูุฑ ุงูุชุฐูุงุฑูุฉ.
          ููุฏ ุฃุฎุจุฑูู ุงููุนูู ุฃู ูุฐุง ุงูููุชุฒู ููุนุฏูู ููุตุฏูุง ููุงุณุจูุง ููุนุงุฆูุงุช ูุงูุฒุงุฆุฑูู ููุง ูุชููุฒ ุจู ูู ูุฏูุกู ูุทุจูุนุฉู ุฎูุงุจุฉ.<br><br>
          ุจุนุฏ ุฐูู ุฌูุณ ุงูุทูุงุจ ูู ููุงูู ุขููู ุธูููุ ูุงุณุชูุนูุง ุฅูู ุดุฑุญู ูู ูุนูู ุงูุนููู ุญูู ุฃูููุฉ ุงููุญุงูุธุฉ ุนูู ุงูุจูุฆุฉุ
          ุซู ูุงููุง ุจุญููุฉู ุตุบูุฑุฉ ูุชูุธูู ุงูููุงู ูู ุงูููุงูุงุช ุงูุชู ูุฏ ูุชุฑููุง ุจุนุถ ุงูุฒูุงุฑุ ุญุชู ูุจูู ุงูููุชุฒูู ุฌููููุง ููุธูููุง.
          ููู ููุงูุฉ ุงูุฑุญูุฉุ ุงุฌุชูุน ุงูุทูุงุจ ูุงูุชูุงุท ุตูุฑุฉู ุฌูุงุนูุฉุ ูุดูุฑูุง ูุนููููู ุนูู ูุฐู ุงูุชุฌุฑุจุฉ ุงูููุชุนุฉ ุงูุชู ุชุนููููุง ูููุง ุงููุซูุฑุ ูุนุงุฏูุง
          ุฅูู ุงููุฏุฑุณุฉ ููู ูุดุนุฑูู ุจุงููุฎุฑ ูุงูุณุนุงุฏุฉ.
        </article>
        <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; align-items:center">
          <button class="btn" id="btnToQuiz">ุงุจุฏุฃ ุงูุฃุณุฆูุฉ</button>
          <span class="muted" style="font-size:13px">ููููู ุงูุฑุฌูุน ูููุต ุฃุซูุงุก ุงูุญู.</span>
        </div>
      </section>

      <!-- ุงูุฃุณุฆูุฉ -->
      <section id="screen-quiz" class="screen">
        <div class="row" style="align-items:flex-end">
          <div class="col"><h3 style="margin:0 0 4px">ุงูุฃุณุฆูุฉ</h3>
            <div class="muted" id="qCounter">ุงูุณุคุงู 1 ูู 10</div>
          </div>
          <div class="col"><div class="progress"><i id="progBar"></i></div></div>
        </div>
        <div id="questionBox" style="margin-top:12px"></div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px">
          <button class="btn secondary" id="btnPrev">ุงูุณุงุจู</button>
          <button class="btn" id="btnNext">ุงูุชุงูู</button>
          <button class="btn ghost" id="btnBackToReading">ุนุฑุถ ุงููุต</button>
          <button class="btn" id="btnSubmit" style="margin-inline-start:auto;">ุฅููุงุก ูุฅุธูุงุฑ ุงููุชูุฌุฉ</button>
        </div>
      </section>

      <!-- ุงููุชูุฌุฉ -->
      <section id="screen-result" class="screen center">
        <h2 style="margin:10px 0 6px">ูุชูุฌุชู</h2>
        <div class="score-big" id="scoreText">0 / 100</div>
        <div class="muted" id="remark" style="margin-top:6px">ุฃุญุณูุช!</div>

        <div style="margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap">
          <button class="btn" id="btnSave">ุญูุธ ูู ุงูุชูุจ ูุงูู</button>
          <button class="btn ghost" id="btnRetry">ุฅุนุงุฏุฉ ุงููุญุงููุฉ</button>
          <button class="btn" id="btnPrintCert">ุทุจุงุนุฉ ุงูุดูุงุฏุฉ</button>
        </div>

        <h3 style="margin-top:20px">๐ ุงูุชูุจ ูุงูู</h3>
        <ul class="top5" id="topList"></ul>

        <!-- ุดูุงุฏุฉ ุจุณูุทุฉ ูุงุจูุฉ ููุทุจุงุนุฉ -->
        <div id="certBox" class="cert" style="display:none">
          <h3>ุดูุงุฏุฉ ุฅูุฌุงุฒ</h3>
          <p>ูููุฏู ูุฐู ุงูุดูุงุฏุฉ ุฅูู ุงูุทุงูุจ:</p>
          <p><strong id="certName">โ</strong></p>
          <p>ูุญุตููู ุนูู ุฏุฑุฌุฉ:</p>
          <p><strong id="certScore">โ</strong> ูู 100</p>
          <p>ูู ุงุฎุชุจุงุฑ ุงูููู ุงููุฑุงุฆู โ ุฑุญูุฉ ุฅูู ููุชุฒู ุฎุฑุทู</p>
          <p class="muted">ูุฏุฑุณุฉ ุงูุฅูุงู ุงูุดููุงูู โ ุฅุนุฏุงุฏ ุงูุฃุณุชุงุฐ ููุฑู ุงููุทูุฑู</p>
          <p id="certDate" class="muted"></p>
        </div>
      </section>

      <!-- ุดุงุดุฉ ุนุฑุถ ุงูุชูุจ ูุงูู ูู ุงูุจุฏุงูุฉ -->
      <section id="screen-top" class="screen">
        <h3 style="margin:6px 0 10px">๐ ุฃุนูู 5 ุฏุฑุฌุงุช</h3>
        <ul class="top5" id="topList2"></ul>
        <div style="margin-top:12px">
          <button class="btn" id="btnBackHome">ุฑุฌูุน</button>
          <button class="btn ghost" id="btnClearTop">ูุณุญ ุงููุงุฆูุฉ</button>
        </div>
      </section>

      <footer class="credit">
        <span class="sig">ุฅุนุฏุงุฏ ุงูุฃุณุชุงุฐ ููุฑู ุงููุทูุฑู</span>
      </footer>
    </div>
  </div>
</div>

<script>
/* โโโ ุฅุนุฏุงุฏุงุช ุนุงูุฉ โโโ */
const EXAM_MINUTES = 12; // ูุฏุฉ ุงูุงุฎุชุจุงุฑ ุจุงูุฏูุงุฆู
const SHEETS_WEBAPP_URL = ""; 
// ูู ุชุจุบู ุชุฌููุน ุงููุชุงุฆุฌ ูู Google Sheets: ุถุน ููุง ุฑุงุจุท ุงูููุจ-ุขุจ (Apps Script) ูุฅูุง ุงุชุฑูู ูุงุฑุบูุง

/* โโโ ุฃุณุฆูุฉ โโโ */
const QUESTIONS = [
  { q:"ูุง ุณุจุจ ุฐูุงุจ ุงูุทูุงุจ ุฅูู ููุชุฒู ุฎุฑุทูุ", a:["ููุนุจ ููุท","ูุฒูุงุฑุฉ ูุฑูุจ","ูุฑุญูุฉ ุชุนููููุฉ ูุงุณุชูุดุงู ุงูููุงู","ููุชุณูู"], correct:2 },
  { q:"ููู ูุงูุช ูุดุงุนุฑ ุงูุทูุงุจ ุฃุซูุงุก ุงูุฑุญูุฉุ", a:["ุงูุฎูู ูุงูููู","ุงูุญูุงุณ ูุงููุฑุญ","ุงูุญุฒู","ุงูููู"], correct:1 },
  { q:"ูุงุฐุง ูุนู ุงูุทูุงุจ ุนูุฏ ูุตูููู ุฅูู ุงูููุชุฒูุ", a:["ุนุงุฏูุง ููุฑูุง","ุฌูุณูุง ูู ุงูุญุงููุฉ","ุชุฌููููุง ูุณุฌูููุง ููุงุญุธุงุชูู","ูุงููุง"], correct:2 },
  { q:"ูููู ุชูููุฒ ุงูููุชุฒู ุจุญุณุจ ุงููุตุ", a:["ุงูุถูุถุงุก ุงูุดุฏูุฏุฉ","ุงููุฏูุก ูุงูุทุจูุนุฉ ุงูุฎูุงุจุฉ","ุงููุญุงู ุงูุชุฌุงุฑูุฉ ุงููุซูุฑุฉ","ุงูุฃูุนุงุจ ุงูููุฑุจุงุฆูุฉ"], correct:1 },
  { q:"ููุงุฐุง ุงูุชูุท ุงูุทูุงุจ ุตูุฑูุง ุชุฐูุงุฑูุฉุ", a:["ูุฅุฑุณุงููุง ูุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ ููุท","ูุฃู ุงููุนูู ุทูุจ ุฏูู ุณุจุจ","ูุชูุซูู ุงูุฑุญูุฉ ูุงูุฐูุฑู ุงูุฌูููุฉ","ููุงุดุชุฑุงู ูู ูุณุงุจูุฉ ุชุตููุฑ"], correct:2 },
  { q:"ูุงุฐุง ุชุนููู ุงูุทูุงุจ ูู ุดุฑุญ ูุนูู ุงูุนูููุ", a:["ุฃูููุฉ ุงูููู ุงูุทููู","ุฃูููุฉ ุงููุญุงูุธุฉ ุนูู ุงูุจูุฆุฉ","ููุงุนุฏ ูุฑุฉ ุงููุฏู","ููููุฉ ุงูุชุณูู"], correct:1 },
  { q:"ูุง ุงููุฏู ูู ุชูุธูู ุงูููุงูุ", a:["ุฅุถุงุนุฉ ุงูููุช","ุงููุญุงูุธุฉ ุนูู ุฌูุงู ุงูููุชุฒู ููุธุงูุชู","ุฒูุงุฏุฉ ุฏุฑุฌุงุช ุงูุญุงุณูุจ","ุชูููุฐ ุฃูุฑ ุฅุฏุงุฑู ููุท"], correct:1 },
  { q:"ูู ุฃู ููุช ูุงูุช ุงูุฑุญูุฉุ", a:["ูู ูุตู ุงูุดุชุงุก","ูู ูุตู ุงูุตูู","ูู ุงููุณุงุก","ูู ููุชุตู ุงูููู"], correct:0 },
  { q:"ุฃูู ุฌูุณ ุงูุทูุงุจ ุจุนุฏ ุงูุชุฌูููุ", a:["ูู ููุงู ุขูู ุธููู","ุนูู ุงูุตุฎูุฑ ุงูุนุงููุฉ","ูุณุท ุงูุทุฑูู","ุฏุงุฎู ุงููุชุฌุฑ"], correct:0 },
  { q:"ูุง ุงูุดุนูุฑ ุงูุฐู ุนุงุฏ ุจู ุงูุทูุงุจ ุฅูู ุงููุฏุฑุณุฉุ", a:["ุงูุญุฒู ูุงูุบุถุจ","ุงููุฎุฑ ูุงูุณุนุงุฏุฉ","ุงูููู ูุงูุฎูู","ุงููุนุงุณ ููุท"], correct:1 }
];

/* โโโ ุนูุงุตุฑ โโโ */
const screenWelcome=document.getElementById("screen-welcome");
const screenReading=document.getElementById("screen-reading");
const screenQuiz=document.getElementById("screen-quiz");
const screenResult=document.getElementById("screen-result");
const screenTop   =document.getElementById("screen-top");

const btnStart=document.getElementById("btnStart");
const btnViewTop=document.getElementById("btnViewTop");
const btnToQuiz=document.getElementById("btnToQuiz");
const btnBackToReading=document.getElementById("btnBackToReading");
const btnPrev=document.getElementById("btnPrev");
const btnNext=document.getElementById("btnNext");
const btnSubmit=document.getElementById("btnSubmit");
const btnSave=document.getElementById("btnSave");
const btnRetry=document.getElementById("btnRetry");
const btnBackHome=document.getElementById("btnBackHome");
const btnClearTop=document.getElementById("btnClearTop");
const btnPrintCert=document.getElementById("btnPrintCert");

const studentNameInput=document.getElementById("studentName");
const qCounter=document.getElementById("qCounter");
const progBar=document.getElementById("progBar");
const questionBox=document.getElementById("questionBox");
const scoreText=document.getElementById("scoreText");
const remark=document.getElementById("remark");
const topList=document.getElementById("topList");
const topList2=document.getElementById("topList2");
const certBox=document.getElementById("certBox");
const certName=document.getElementById("certName");
const certScore=document.getElementById("certScore");
const certDate=document.getElementById("certDate");
const timeLeftEl=document.getElementById("timeLeft");

/* โโโ ุญุงูุฉ โโโ */
let current=0;
let answers=Array(QUESTIONS.length).fill(null);
let student="";
let startedAt=0;
let deadlineTs=0;
let timerId=null;

/* โโโ ุฃุฏูุงุช โโโ */
function show(id){ [screenWelcome,screenReading,screenQuiz,screenResult,screenTop].forEach(s=>s.classList.remove("active")); id.classList.add("active"); window.scrollTo({top:0,behavior:"smooth"}); }
function renderQuestion(){
  const q=QUESTIONS[current];
  qCounter.textContent=`ุงูุณุคุงู ${current+1} ูู ${QUESTIONS.length}`;
  progBar.style.width=`${(current)/QUESTIONS.length*100}%`;
  questionBox.innerHTML = `
    <div class="long-text" style="margin-bottom:10px"><strong>${q.q}</strong></div>
    ${q.a.map((opt,i)=>`
      <label class="choice ${answers[current]===i?"selected":""}">
        <input type="radio" name="q${current}" value="${i}" ${answers[current]===i?"checked":""} />
        <div>${opt}</div>
      </label>`).join("")}
  `;
}
function recordAnswer(){
  const selected=document.querySelector(`input[name="q${current}"]:checked`);
  if(selected) answers[current]=Number(selected.value);
}
function computeScore(){
  let c=0; answers.forEach((ans,i)=>{ if(ans===QUESTIONS[i].correct) c++; });
  return Math.round((c/QUESTIONS.length)*100);
}
function saveTop(name,score){
  const KEY="khartam_top5_v2"; const list=JSON.parse(localStorage.getItem(KEY)||"[]");
  list.push({name,score,ts:Date.now()}); list.sort((a,b)=> b.score-a.score || a.ts-b.ts);
  const top5=list.slice(0,5); localStorage.setItem(KEY,JSON.stringify(top5)); return top5;
}
function readTop(){ return JSON.parse(localStorage.getItem("khartam_top5_v2")||"[]"); }
function renderTop(ul,data){ ul.innerHTML=data.length? data.map((r,i)=>`<li><strong>${i+1}. ${r.name}</strong><span class="pill">${r.score}</span></li>`).join(""):`<li style="justify-content:center">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ุจุนุฏ</li>`; }

function startTimer(minutes){
  const ms=minutes*60*1000; startedAt=Date.now(); deadlineTs=startedAt+ms;
  updateTimer(); timerId=setInterval(updateTimer,500);
}
function updateTimer(){
  const remain=Math.max(0, deadlineTs-Date.now());
  const mm=Math.floor(remain/60000); const ss=Math.floor((remain%60000)/1000);
  timeLeftEl.textContent = `${mm.toString().padStart(2,"0")}:${ss.toString().padStart(2,"0")}`;
  if(remain<=0){ clearInterval(timerId); finishExam(true); }
}

/* โโโ ุฅุฑุณุงู ูุบูุบู ุดูุช (ุงุฎุชูุงุฑู) โโโ */
async function sendToSheets(payload){
  if(!SHEETS_WEBAPP_URL) return; // ุบูุฑ ููุนูู
  try{
    await fetch(SHEETS_WEBAPP_URL,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
  }catch(e){ /* ุชุฌุงูู ุงูุฃุฎุทุงุก ุงูุตุงูุชุฉ */ }
}

/* โโโ ุฃุญุฏุงุซ โโโ */
btnStart.addEventListener("click", ()=>{
  const name=(studentNameInput.value||"").trim();
  if(!name){ studentNameInput.focus(); studentNameInput.placeholder="ุงูุงุณู ูุทููุจ ูููุชุงุจุนุฉ"; return; }
  student=name;
  startTimer(EXAM_MINUTES);
  show(screenReading);
});
btnViewTop.addEventListener("click", ()=>{ renderTop(topList2, readTop()); show(screenTop); });
btnBackHome.addEventListener("click", ()=> show(screenWelcome));
btnClearTop.addEventListener("click", ()=>{ localStorage.removeItem("khartam_top5_v2"); renderTop(topList2,[]); });

btnToQuiz.addEventListener("click", ()=>{ show(screenQuiz); renderQuestion(); });

btnBackToReading.addEventListener("click", ()=> show(screenReading));
btnPrev.addEventListener("click", ()=>{ recordAnswer(); if(current>0){ current--; renderQuestion(); }});
btnNext.addEventListener("click", ()=>{ recordAnswer(); if(current<QUESTIONS.length-1){ current++; renderQuestion(); }});

btnSubmit.addEventListener("click", ()=> finishExam(false));

function finishExam(timeUp){
  recordAnswer();
  const allAnswered = answers.every(v=>v!==null);
  if(!allAnswered && !timeUp){
    alert("ุงูุฑุฌุงุก ุงูุฅุฌุงุจุฉ ุนูู ุฌููุน ุงูุฃุณุฆูุฉ ุฃูููุง โ");
    return;
  }
  if(timerId) clearInterval(timerId);
  const score=computeScore();
  scoreText.textContent=`${score} / 100`;
  remark.textContent = score>=90 ? "ููุชุงุฒ! ุชุฃูููุช โจ"
                    : score>=75 ? "ุฃุญุณูุช! ุชูุฏูู ุฌููู ๐"
                    : score>=50 ? "ูุญุงููุฉ ุทูุจุฉ โ ูุงุตู ุงูุชุฏุฑูุจ ๐ช"
                                : "ุชุญุชุงุฌ ูุฑุงุฌุนุฉ ุงููุต ุซู ุงููุญุงููุฉ ูุฌุฏุฏูุง ๐";
  renderTop(topList, readTop());
  show(screenResult);
  if(score>=85){ fireConfetti(); }

  // ุชุฌููุฒ ุงูุดูุงุฏุฉ
  certName.textContent = student;
  certScore.textContent = score;
  certDate.textContent = new Date().toLocaleDateString('ar-SA',{year:'numeric',month:'long',day:'numeric'});
  certBox.style.display = "block";

  // ุฅุฑุณุงู ุงุฎุชูุงุฑู ูุบูุบู ุดูุช
  sendToSheets({name:student, score, when:new Date().toISOString()});
}

btnSave.addEventListener("click", ()=>{
  if(!student) return;
  const score = Number(scoreText.textContent.split(" / ")[0])||0;
  const updated = saveTop(student, score);
  renderTop(topList, updated);
  renderTop(topList2, updated);
  btnSave.disabled=true; btnSave.textContent="ุชู ุงูุญูุธ โ";
});

btnRetry.addEventListener("click", ()=>{
  answers=Array(QUESTIONS.length).fill(null); current=0;
  startTimer(EXAM_MINUTES);
  show(screenQuiz); renderQuestion();
});

btnPrintCert.addEventListener("click", ()=>{
  // ุฃุจุณุท ุทุฑููุฉ ูุชูุงููุฉ ูุน iOS: ุทุจุงุนุฉ/ุญูุธ PDF ุนุจุฑ ูุงุฌูุฉ ุงููุชุตูุญ
  window.print();
});

/* โโโ ูุคุซุฑ ุจุณูุท โโโ */
function fireConfetti(){
  const canvas=document.createElement("canvas");
  canvas.width=window.innerWidth; canvas.height=window.innerHeight;
  canvas.style.position="fixed"; canvas.style.inset="0"; canvas.style.pointerEvents="none"; canvas.style.zIndex="9999";
  document.body.appendChild(canvas);
  const ctx=canvas.getContext("2d"); const N=120;
  const parts=Array.from({length:N}).map(()=>({x:Math.random()*canvas.width,y:-20-Math.random()*canvas.height*0.3,r:4+Math.random()*4,vx:(Math.random()-.5)*2,vy:2+Math.random()*3,a:.8+Math.random()*.2}));
  let t=0; (function frame(){ t++; ctx.clearRect(0,0,canvas.width,canvas.height);
    parts.forEach(p=>{ p.x+=p.vx + Math.sin((p.y+t)/40)*0.4; p.y+=p.vy; ctx.globalAlpha=p.a; ctx.fillStyle=["#1e7f3d","#2fb36a","#f1c40f","#27ae60","#16a085"][p.r|0 % 5]; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); });
    if(t<260) requestAnimationFrame(frame); else canvas.remove();
  })();
}

/* โโโ ูููุน ุชูุจูุฑ ุจุงูุฅููุงุกุงุช ุนูู iOS โโโ */
document.addEventListener('gesturestart', e=>e.preventDefault(), {passive:false});
</script>
</body>
</html>
